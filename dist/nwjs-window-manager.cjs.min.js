"use strict";function n(n,e,t,o){return new(t||(t=Promise))((function(i,a){function r(n){try{c(o.next(n))}catch(n){a(n)}}function l(n){try{c(o.throw(n))}catch(n){a(n)}}function c(n){var e;n.done?i(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(r,l)}c((o=o.apply(n,e||[])).next())}))}Object.defineProperty(exports,"__esModule",{value:!0});const e=nw.require("node:events");function t(n){return new Promise((e=>{"complete"===n.readyState||"interactive"===n.readyState?e():n.addEventListener("DOMContentLoaded",(()=>e()))}))}let o,i="";const a={};let r=Date.now();function l(n){if(n)return"string"==typeof n?a[n]:"nwWin"in n?n:"cWindow"in n?c().find((e=>e.nwWin.window===n.window)):void 0}function c(n){const e=Object.values(a);return n&&n(e),e}function s(n){return!!n.find((n=>n.modalParent))}function d(n){return!!n.find((n=>n.modal||d(n.children)))}function f(n){return n.alwaysOnTop||n.parent&&f(n.parent)||!1}function p(n,e){const{parent:t,modal:o,always_on_top:i,position:a,x:r,y:l,width:c,height:s}=e;t&&(n.parent=w(t)),"boolean"==typeof o&&(n.modalParent=o),f(n)?n.alwaysOnTop=!0:"boolean"==typeof i&&(n.alwaysOnTop=i),"number"==typeof c&&(n.width=c),"number"==typeof s&&(n.height=s),"center"===a?n.centerToScreen():"parentCenter"===a&&n.centerToParent(),"number"==typeof r&&(n.x=r),"number"==typeof l&&(n.y=l)}function w(c,u={}){if(!c)return;const h=l(c);if(h)return u.name&&console.warn(`The WM_Window instance already exists, the name "${h.name}" is readonly and cannot be reassigned.`),p(h,u),h;if("object"==typeof c&&"cWindow"in c){const y=new e,g=c;let v,O,b=u.name||"wm_"+ ++r,x=u.modal||!1,T=!1,j=!1,P=!1,M=!1,W=[];function $(n){O=n,O.children.push(v),x&&!O.modal&&(O.modal=!0)}function A(){if(O){const n=O.children.indexOf(v);n>=0&&(O.children.splice(n,1),s(O.children)||(O.modal=!1)),O=void 0}}const _=g.setAlwaysOnTop,E=g.close,S=g.on,z=[];return v=Object.assign(g,{nwWin:g,name:b,modalParent:x,modal:T,alwaysOnTop:j,isMinimize:P,isMaximize:M,children:W,parent:void 0,open:(n,e,t)=>("function"==typeof e&&(t=e,e={}),m(n,Object.assign({parent:v},e),t)),centerToParent:()=>(v.parent&&(v.x=Math.round(v.parent.x+(v.parent.width-v.width)/2),v.y=Math.round(v.parent.y+(v.parent.height-v.height)/2)),v),centerToScreen(){const n=v.window.screen;return v.x=Math.round(n.availLeft+(n.availWidth-v.width)/2),v.y=Math.round(n.availTop+(n.availHeight-v.height)/2),v},setAlwaysOnTop(n){n?(j=!0,_.call(v,!0),W.forEach((n=>n.alwaysOnTop=!0))):f(v)||(j=!1,_.call(v,!1))},close(n){(n||!T&&!d(W))&&(A(),delete a[b],E.call(v,!0),W.forEach((n=>n.close(!0))))},on:(n,e)=>("close"===n?z.push(e):S.call(v,n,e),v),$on:(n,e)=>(y.on(n,e),v),$once:(n,e)=>(y.once(n,e),v),$off:(n,e)=>(y.off(n,e),v),$offAll:n=>(y.removeAllListeners(n),v),$emit:(n,...e)=>(y.emit.call(y,n,...e),v)}),Object.defineProperties(v,{nwWin:{get:()=>g},name:{get:()=>b},alwaysOnTop:{get:()=>j,set(n){this.setAlwaysOnTop(n)}},isMinimize:{get:()=>P},isMaximize:{get:()=>M},modalParent:{get:()=>x,set(n){n!==x&&O&&(n?O.modal||(O.modal=!0,x=!0):s(O.children)||(O.modal=!1,x=!1))}},modal:{get:()=>T,set(e){e!==T&&(e?(!function(e){n(this,void 0,void 0,(function*(){const n=e.window.document;yield t(n);const o=n.createElement("style");o.id="nwjs-window-manager-style",o.innerHTML=`html, body {\n  overflow: hidden !important;\n}\n.nwjs-window-manager-modal {\n  position: fixed;\n  top: 0;\n  right: 0;\n  width: 100%;\n  height: 100%;\n  background: rgba(255, 255, 255, 0.95);\n  z-index: 10000;\n}\n${i}`,n.head.appendChild(o);const a=n.createElement("div");a.classList.add("nwjs-window-manager-modal"),n.body.appendChild(a)}))}(v),T=!0):s(W)||(!function(e){n(this,void 0,void 0,(function*(){const n=e.window.document;yield t(n),n.querySelectorAll("#nwjs-window-manager-style,.nwjs-window-manager-modal").forEach((n=>n.remove()))}))}(v),T=!1))}},children:{get:()=>W},parent:{get:()=>O,set(n){if(n){const e=w(n);e&&e!==O&&(A(),$(e))}else A()}}}),p(v,u),a[b]=v,v.on("focus",(()=>{let n;W.forEach((e=>{e.isMinimize||(e.focus(),n=e)})),n&&o&&o(n)})),S.call(v,"close",(()=>{z.length>0?z.forEach((n=>n())):T||d(W)||v.close(!0)})),v.on("minimize",(()=>{T||x?v.restore():P=!0})),v.on("maximize",(()=>{T?v.restore():M=!0})),v.on("restore",(()=>{P=!1,M=!1})),v}}function m(n,e={},t=(()=>{})){return new Promise((o=>{"function"==typeof e&&(t=e,e={});const{name:i="wm_"+ ++r,parent:l,modal:c}=e,s=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]])}return t}(e,["name","parent","modal"]),{position:d,always_on_top:f}=e;if(a[i]){const n=a[i];return n.focus(),t(n),o(n)}const p=!1!==s.show;s.show=!1,nw.Window.open(n,s,(n=>{if(!n)return;const e=w(n,{name:i,parent:l,modal:c,position:d,always_on_top:f});p&&e.show(),t(e),o(e)}))}))}const u=new e,h=Object.assign(w,{open:m,get:l,getAll:c,config:function(n){"string"==typeof n.modalStyle&&(i=n.modalStyle),"function"==typeof n.onAutoFocusTailWindow&&(o=n.onAutoFocusTailWindow)},$on:(n,e)=>(u.on(n,e),h),$once:(n,e)=>(u.once(n,e),h),$off:(n,e)=>(u.off(n,e),h),$offAll:n=>(u.removeAllListeners(n),h),$emit:(n,...e)=>(u.emit.call(u,n,...e),h)});exports.wm=h;
