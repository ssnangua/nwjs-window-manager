!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((n="undefined"!=typeof globalThis?globalThis:n||self)["nwjs-window-manager"]={})}(this,(function(n){"use strict";function e(n,e,o,t){return new(o||(o=Promise))((function(i,a){function r(n){try{c(t.next(n))}catch(n){a(n)}}function l(n){try{c(t.throw(n))}catch(n){a(n)}}function c(n){var e;n.done?i(n.value):(e=n.value,e instanceof o?e:new o((function(n){n(e)}))).then(r,l)}c((t=t.apply(n,e||[])).next())}))}const o=nw.require("node:events");function t(n){return new Promise((e=>{"complete"===n.readyState||"interactive"===n.readyState?e():n.addEventListener("DOMContentLoaded",(()=>e()))}))}let i,a="";const r={};let l=Date.now();function c(n){if(n)return"string"==typeof n?r[n]:"nwWin"in n?n:"cWindow"in n?s().find((e=>e.nwWin.window===n.window)):void 0}function s(n){const e=Object.values(r);return n&&n(e),e}function d(n){return!!n.find((n=>n.modalParent))}function f(n){return!!n.find((n=>n.modal||f(n.children)))}function p(n){return n.alwaysOnTop||n.parent&&p(n.parent)||!1}function u(n,e){const{parent:o,modal:t,always_on_top:i,position:a,x:r,y:l,width:c,height:s}=e;o&&(n.parent=w(o)),"boolean"==typeof t&&(n.modalParent=t),p(n)?n.alwaysOnTop=!0:"boolean"==typeof i&&(n.alwaysOnTop=i),"number"==typeof c&&(n.width=c),"number"==typeof s&&(n.height=s),"center"===a?n.centerToScreen():"parentCenter"===a&&n.centerToParent(),"number"==typeof r&&(n.x=r),"number"==typeof l&&(n.y=l)}function w(n,s={}){if(!n)return;const h=c(n);if(h)return s.name&&console.warn(`The WM_Window instance already exists, the name "${h.name}" is readonly and cannot be reassigned.`),u(h,s),h;if("object"==typeof n&&"cWindow"in n){const y=new o,g=n;let b,v,O=s.name||"wm_"+ ++l,T=s.modal||!1,x=!1,j=!1,P=!1,M=!1,W=[];function $(n){v=n,v.children.push(b),T&&!v.modal&&(v.modal=!0)}function A(){if(v){const n=v.children.indexOf(b);n>=0&&(v.children.splice(n,1),d(v.children)||(v.modal=!1)),v=void 0}}const _=g.setAlwaysOnTop,E=g.close,S=g.on,z=[];return b=Object.assign(g,{nwWin:g,name:O,modalParent:T,modal:x,alwaysOnTop:j,isMinimize:P,isMaximize:M,children:W,parent:void 0,open:(n,e,o)=>("function"==typeof e&&(o=e,e={}),m(n,Object.assign({parent:b},e),o)),centerToParent:()=>(b.parent&&(b.x=Math.round(b.parent.x+(b.parent.width-b.width)/2),b.y=Math.round(b.parent.y+(b.parent.height-b.height)/2)),b),centerToScreen(){const n=b.window.screen;return b.x=Math.round(n.availLeft+(n.availWidth-b.width)/2),b.y=Math.round(n.availTop+(n.availHeight-b.height)/2),b},setAlwaysOnTop(n){n?(j=!0,_.call(b,!0),W.forEach((n=>n.alwaysOnTop=!0))):p(b)||(j=!1,_.call(b,!1))},close(n){(n||!x&&!f(W))&&(A(),delete r[O],E.call(b,!0),W.forEach((n=>n.close(!0))))},on:(n,e)=>("close"===n?z.push(e):S.call(b,n,e),b),$on:(n,e)=>(y.on(n,e),b),$once:(n,e)=>(y.once(n,e),b),$off:(n,e)=>(y.off(n,e),b),$offAll:n=>(y.removeAllListeners(n),b),$emit:(n,...e)=>(y.emit.call(y,n,...e),b)}),Object.defineProperties(b,{nwWin:{get:()=>g},name:{get:()=>O},alwaysOnTop:{get:()=>j,set(n){this.setAlwaysOnTop(n)}},isMinimize:{get:()=>P},isMaximize:{get:()=>M},modalParent:{get:()=>T,set(n){n!==T&&v&&(n?v.modal||(v.modal=!0,T=!0):d(v.children)||(v.modal=!1,T=!1))}},modal:{get:()=>x,set(n){n!==x&&(n?(!function(n){e(this,void 0,void 0,(function*(){const e=n.window.document;yield t(e);const o=e.createElement("style");o.id="nwjs-window-manager-style",o.innerHTML=`html, body {\n  overflow: hidden !important;\n}\n.nwjs-window-manager-modal {\n  position: fixed;\n  top: 0;\n  right: 0;\n  width: 100%;\n  height: 100%;\n  background: rgba(255, 255, 255, 0.95);\n  z-index: 10000;\n}\n${a}`,e.head.appendChild(o);const i=e.createElement("div");i.classList.add("nwjs-window-manager-modal"),e.body.appendChild(i)}))}(b),x=!0):d(W)||(!function(n){e(this,void 0,void 0,(function*(){const e=n.window.document;yield t(e),e.querySelectorAll("#nwjs-window-manager-style,.nwjs-window-manager-modal").forEach((n=>n.remove()))}))}(b),x=!1))}},children:{get:()=>W},parent:{get:()=>v,set(n){if(n){const e=w(n);e&&e!==v&&(A(),$(e))}else A()}}}),u(b,s),r[O]=b,b.on("focus",(()=>{let n;W.forEach((e=>{e.isMinimize||(e.focus(),n=e)})),n&&i&&i(n)})),S.call(b,"close",(()=>{z.length>0?z.forEach((n=>n())):x||f(W)||b.close(!0)})),b.on("minimize",(()=>{x||T?b.restore():P=!0})),b.on("maximize",(()=>{x?b.restore():M=!0})),b.on("restore",(()=>{P=!1,M=!1})),b}}function m(n,e={},o=(()=>{})){return new Promise((t=>{"function"==typeof e&&(o=e,e={});const{name:i="wm_"+ ++l,parent:a,modal:c}=e,s=function(n,e){var o={};for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&e.indexOf(t)<0&&(o[t]=n[t]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(t=Object.getOwnPropertySymbols(n);i<t.length;i++)e.indexOf(t[i])<0&&Object.prototype.propertyIsEnumerable.call(n,t[i])&&(o[t[i]]=n[t[i]])}return o}(e,["name","parent","modal"]),{position:d,always_on_top:f}=e;if(r[i]){const n=r[i];return n.focus(),o(n),t(n)}const p=!1!==s.show;s.show=!1,nw.Window.open(n,s,(n=>{if(!n)return;const e=w(n,{name:i,parent:a,modal:c,position:d,always_on_top:f});p&&e.show(),o(e),t(e)}))}))}const h=new o,y=Object.assign(w,{open:m,get:c,getAll:s,config:function(n){"string"==typeof n.modalStyle&&(a=n.modalStyle),"function"==typeof n.onAutoFocusTailWindow&&(i=n.onAutoFocusTailWindow)},$on:(n,e)=>(h.on(n,e),y),$once:(n,e)=>(h.once(n,e),y),$off:(n,e)=>(h.off(n,e),y),$offAll:n=>(h.removeAllListeners(n),y),$emit:(n,...e)=>(h.emit.call(h,n,...e),y)});n.wm=y,Object.defineProperty(n,"__esModule",{value:!0})}));
