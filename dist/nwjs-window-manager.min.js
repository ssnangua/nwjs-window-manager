!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("node:events")):"function"==typeof define&&define.amd?define(["exports","node:events"],e):e((n="undefined"!=typeof globalThis?globalThis:n||self)["nwjs-window-manager"]={},n.require$$0)}(this,(function(n,e){"use strict";function t(n){return n&&"object"==typeof n&&"default"in n?n:{default:n}}function o(n,e,t,o){return new(t||(t=Promise))((function(i,a){function r(n){try{c(o.next(n))}catch(n){a(n)}}function l(n){try{c(o.throw(n))}catch(n){a(n)}}function c(n){var e;n.done?i(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(r,l)}c((o=o.apply(n,e||[])).next())}))}const i=t(e).default;function a(n){return new Promise((e=>{"complete"===n.readyState||"interactive"===n.readyState?e():n.addEventListener("DOMContentLoaded",(()=>e()))}))}let r,l="";const c={};let s=Date.now();function d(n,e={},t=(()=>{})){return new Promise((o=>{"function"==typeof e&&(t=e,e={});const{name:i="wm_"+ ++s,parent:a,modal:r}=e,l=function(n,e){var t={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(n);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(n,o[i])&&(t[o[i]]=n[o[i]])}return t}(e,["name","parent","modal"]),{position:d,always_on_top:f}=e;if(c[i]){const n=c[i];return n.focus(),t(n),o(n)}const p=!1!==l.show;l.show=!1,nw.Window.open(n,l,(n=>{if(!n)return;const e=y(n,{name:i,parent:a,modal:r,position:d,always_on_top:f});p&&e.show(),t(e),o(e)}))}))}function f(n){if(n)return"string"==typeof n?c[n]:"nwWin"in n?n:"cWindow"in n?p().find((e=>e.nwWin.window===n.window)):void 0}function p(n){const e=Object.values(c);return n&&n(e),e}function u(n){return!!n.find((n=>n.modalParent))}function m(n){return!!n.find((n=>n.modal||m(n.children)))}function w(n){return n.alwaysOnTop||n.parent&&w(n.parent)||!1}function y(n,e={}){if(!n)return;const t=f(n);if(t){const{parent:p,modal:h}=e;return p&&(t.parent=y(p)),void 0!==h&&t.parent&&(t.parent.modal=h),t}if("object"==typeof n&&"cWindow"in n){const g=n,v=new i;let O,b=e.name||"wm_"+ ++s,j=e.modal||!1,x=!1,T=!1,$=!1,A=!1,P=[];function _(n){O=n,O.children.push(L),j&&!O.modal&&(O.modal=!0)}function E(){if(O){const n=O.children.indexOf(L);n>=0&&(O.children.splice(n,1),u(O.children)||(O.modal=!1)),O=void 0}}const W=g.setAlwaysOnTop,z=g.close,M=g.on,S=[],L=Object.assign(g,{nwWin:g,name:b,modalParent:j,modal:x,alwaysOnTop:T,isMinimize:$,isMaximize:A,children:P,parent:void 0,open:(n,e,t)=>("function"==typeof e&&(t=e,e={}),d(n,Object.assign({parent:L},e),t)),setAlwaysOnTop(n){n?(T=!0,W.call(L,!0),P.forEach((n=>n.alwaysOnTop=!0))):w(L)||(T=!1,W.call(L,!1))},close(n){(n||!x&&!m(P))&&(E(),delete c[b],z.call(L,!0),P.forEach((n=>n.close(!0))))},on:(n,e)=>("close"===n?S.push(e):M.call(L,n,e),L),$on:(n,e)=>(v.on(n,e),L),$once:(n,e)=>(v.once(n,e),L),$off:(n,e)=>(v.off(n,e),L),$offAll:n=>(v.removeAllListeners(n),L),$emit:(n,...e)=>(v.emit.call(v,n,...e),L)});return Object.defineProperties(L,{nwWin:{get:()=>g},name:{get:()=>b},alwaysOnTop:{get:()=>T,set(n){this.setAlwaysOnTop(n)}},isMinimize:{get:()=>$},isMaximize:{get:()=>A},modalParent:{get:()=>j,set(n){n!==j&&O&&(n?O.modal||(O.modal=!0,j=!0):u(O.children)||(O.modal=!1,j=!1))}},modal:{get:()=>x,set(n){n!==x&&(n?(!function(n){o(this,void 0,void 0,(function*(){const e=n.window.document;yield a(e);const t=e.createElement("style");t.id="nwjs-window-manager-style",t.innerHTML=`html, body {\n  overflow: hidden !important;\n}\n.nwjs-window-manager-modal {\n  position: fixed;\n  top: 0;\n  right: 0;\n  width: 100%;\n  height: 100%;\n  background: rgba(255, 255, 255, 0.95);\n  z-index: 10000;\n}\n${l}`,e.head.appendChild(t);const o=e.createElement("div");o.classList.add("nwjs-window-manager-modal"),e.body.appendChild(o)}))}(L),x=!0):u(P)||(!function(n){o(this,void 0,void 0,(function*(){const e=n.window.document;yield a(e),e.querySelectorAll("#nwjs-window-manager-style,.nwjs-window-manager-modal").forEach((n=>n.remove()))}))}(L),x=!1))}},children:{get:()=>P},parent:{get:()=>O,set(n){if(n){const e=y(n);e&&e!==O&&(E(),_(e))}else E()}}}),e.parent&&(L.parent=y(e.parent)),(e.always_on_top||w(L))&&(L.alwaysOnTop=!0),L.parent&&"parentCenter"===e.position&&(L.x=L.parent.x+(L.parent.width-L.width)/2,L.y=L.parent.y+(L.parent.height-L.height)/2),c[b]=L,L.on("focus",(()=>{let n;P.forEach((e=>{e.isMinimize||(e.focus(),n=e)})),n&&r&&r(n)})),M.call(L,"close",(()=>{S.length>0?S.forEach((n=>n())):x||m(P)||L.close(!0)})),L.on("minimize",(()=>{x||j?L.restore():$=!0})),L.on("maximize",(()=>{x?L.restore():A=!0})),L.on("restore",(()=>{$=!1,A=!1})),L}}const h=new i,g=Object.assign(y,{open:d,get:f,getAll:p,config:function(n){"string"==typeof n.modalStyle&&(l=n.modalStyle),"function"==typeof n.onAutoFocusTailWindow&&(r=n.onAutoFocusTailWindow)},$on:(n,e)=>(h.on(n,e),g),$once:(n,e)=>(h.once(n,e),g),$off:(n,e)=>(h.off(n,e),g),$offAll:n=>(h.removeAllListeners(n),g),$emit:(n,...e)=>(h.emit.call(h,n,...e),g)});n.wm=g,Object.defineProperty(n,"__esModule",{value:!0})}));
